# 부하 테스트 시나리오 상세 가이드

이 문서는 각 부하 테스트 시나리오의 상세한 부하 설정과 사용 목적을 설명합니다.

## 시나리오 목록

### 1. basic-load-test.yml

**목적:** 기본 부하 테스트  
**대상:** 공개 API 엔드포인트  
**테스트 항목:**
- Health check (`/hello`)
- Root endpoint (`/`)
- 제품 목록 조회 (`/products`)
- 제품 상세 조회 (`/products/:id`)

**부하 설정:**

| 단계 | 지속 시간 | 초기 부하 | 최종 부하 | 설명 |
|------|-----------|-----------|-----------|------|
| Warm up | 30초 | 1 req/s | 5 req/s | 점진적 부하 증가 |
| Normal load | 60초 | 5 req/s | 5 req/s | 정상 부하 유지 |
| Peak load | 30초 | 10 req/s | 10 req/s | 피크 부하 테스트 |
| Cool down | 20초 | 10 req/s | 1 req/s | 점진적 부하 감소 |

**총 테스트 시간:** 약 2분 20초

**사용 시나리오:**
- 일반적인 API 성능 측정
- 기본 엔드포인트 안정성 확인
- 초기 부하 테스트

---

### 2. products-api-test.yml

**목적:** 제품 API 전용 부하 테스트  
**대상:** 제품 관련 API 엔드포인트  
**테스트 항목:**
- 제품 검색 (`/products` with query)
- 카페별 제품 조회 (`/products/cafe-info-code/:code`)
- 제품 상세 조회 (`/products/:id`)
- 관리자 제품 목록 (`/products/admin`)

**부하 설정:**

| 단계 | 지속 시간 | 초기 부하 | 최종 부하 | 설명 |
|------|-----------|-----------|-----------|------|
| Ramp up | 60초 | 3 req/s | 8 req/s | 점진적 부하 증가 |
| Sustained load | 120초 | 8 req/s | 8 req/s | 지속 부하 유지 |
| Ramp down | 30초 | 8 req/s | 2 req/s | 점진적 부하 감소 |

**총 테스트 시간:** 약 3분 30초

**사용 시나리오:**
- 제품 API 성능 최적화
- 제품 검색 기능 부하 테스트
- 데이터베이스 쿼리 성능 확인

---

### 3. stress-test.yml

**목적:** 스트레스 테스트 및 시스템 한계점 확인  
**대상:** 모든 공개 API 엔드포인트  
**테스트 항목:**
- Health check
- Root endpoint
- 제품 목록 조회
- 제품 상세 조회
- 카페별 제품 조회

**부하 설정:**

| 단계 | 지속 시간 | 초기 부하 | 최종 부하 | 설명 |
|------|-----------|-----------|-----------|------|
| Rapid ramp up | 20초 | 5 req/s | 20 req/s | 빠른 부하 증가 |
| Maximum stress | 60초 | 20 req/s | 20 req/s | 최대 부하 유지 |
| Spike test | 10초 | 50 req/s | 50 req/s | 스파이크 테스트 |
| Recovery test | 30초 | 50 req/s | 5 req/s | 복구 테스트 |

**총 테스트 시간:** 약 2분

**주의사항:**
- ⚠️ 높은 부하로 인해 서버에 부담을 줄 수 있습니다
- 프로덕션 환경에서는 주의해서 사용하세요
- 시스템 리소스 모니터링 권장

**사용 시나리오:**
- 시스템 한계점 확인
- 스파이크 트래픽 대응 능력 테스트
- 자동 스케일링 설정 검증
- 장애 복구 능력 확인

---

### 4. meta-viewer-test.yml

**목적:** 메타 뷰어 API 부하 테스트  
**대상:** MetaViewerInfo 조회 API  
**테스트 항목:**
- Code 기반 MetaViewerInfo 조회 (`/meta-viewer-infos/code/:code`)

**부하 설정:**

| 단계 | 지속 시간 | 초기 부하 | 최종 부하 | 설명 |
|------|-----------|-----------|-----------|------|
| Warm up | 30초 | 2 req/s | 5 req/s | 점진적 부하 증가 |
| Normal load | 90초 | 5 req/s | 5 req/s | 정상 부하 유지 |
| Cool down | 20초 | 5 req/s | 1 req/s | 점진적 부하 감소 |

**총 테스트 시간:** 약 2분 20초

**사용 시나리오:**
- 메타 뷰어 API 성능 측정
- Code 기반 조회 최적화
- 캐싱 효과 확인

---

## 부하 설정 용어 설명

### arrivalRate
초당 도착하는 가상 사용자 수 (req/s)

### rampTo
점진적으로 증가/감소할 목표 부하량

### duration
해당 부하 단계의 지속 시간 (초)

### 예시

```yaml
- duration: 30
  arrivalRate: 1
  rampTo: 5
  name: "Warm up"
```

이 설정은:
- 30초 동안
- 초당 1명의 사용자에서 시작하여
- 초당 5명의 사용자까지 점진적으로 증가
- "Warm up" 단계

## 시나리오 수정 가이드

### 테스트 대상 서버 변경

```yaml
config:
  target: "http://localhost:4000"  # 변경할 서버 URL
```

### 부하 강도 조정

```yaml
phases:
  - duration: 60        # 지속 시간 (초)
    arrivalRate: 5     # 초기 부하 (req/s)
    rampTo: 10         # 최종 부하 (req/s)
    name: "단계 이름"
```

### 엔드포인트 추가/수정

```yaml
scenarios:
  - name: "시나리오 이름"
    flow:
      - get:
          url: "/your-endpoint"
          qs:
            param: "value"
```

## 권장 테스트 순서

1. **basic-load-test.yml** - 기본 성능 확인
2. **products-api-test.yml** - 특정 기능 집중 테스트
3. **meta-viewer-test.yml** - 특정 API 테스트
4. **stress-test.yml** - 한계점 확인 (주의 필요)

## 모니터링 권장 사항

부하 테스트 실행 시 다음을 모니터링하세요:

- **CPU 사용률** - 80% 이상이면 부하 조정 고려
- **메모리 사용률** - 메모리 누수 확인
- **응답 시간** - P95 응답 시간이 1초 이상이면 최적화 필요
- **에러율** - 1% 이상이면 문제 확인 필요
- **데이터베이스 연결 수** - 연결 풀 고갈 확인

## 결과 해석

### 좋은 결과
- ✅ 평균 응답 시간 < 200ms
- ✅ P95 응답 시간 < 500ms
- ✅ 에러율 < 0.1%
- ✅ CPU 사용률 < 70%

### 개선이 필요한 결과
- ⚠️ 평균 응답 시간 > 500ms
- ⚠️ P95 응답 시간 > 1초
- ⚠️ 에러율 > 1%
- ⚠️ CPU 사용률 > 80%

## 주의사항

1. **프로덕션 환경 테스트**
   - 낮은 부하로 시작
   - 점진적으로 부하 증가
   - 비피크 시간대에 테스트

2. **데이터베이스 부하**
   - 테스트 전 백업 권장
   - 테스트 데이터 사용 고려

3. **네트워크 대역폭**
   - 로컬 네트워크 대역폭 확인
   - 외부 API 호출 시 Rate Limit 확인

4. **리소스 모니터링**
   - 서버 리소스 실시간 모니터링
   - 이상 징후 발견 시 즉시 중단

